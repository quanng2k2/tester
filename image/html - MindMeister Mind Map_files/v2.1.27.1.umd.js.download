var __accessCheck=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},__privateGet=(e,t,i)=>(__accessCheck(e,t,"read from private field"),i?i.call(e):t.get(e)),__privateAdd=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},__privateMethod=(e,t,i)=>(__accessCheck(e,t,"access private method"),i);!function(e){!function(e){var t,i,s,r,n;if("use strict",false){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}let o=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let s=63&i[e];if(36>s)t+=s.toString(36);else if(62>s)t+=(s-26).toString(36).toUpperCase();else if(63>s)t+="_";else t+="-"}return t};function a(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));if(t)return t[2]}function c(e,t,i=""){const s=new Date;s.setTime(s.getTime()+365*24*60*60*1e3),document.cookie=`${e}=${t}; expires=${s.toUTCString()}; path=/; ${i?`domain=${i}`:""}`}function u(e){const t=new RegExp(`[?&]${e}=([^&#]*)`).exec(window.location.href);return t?decodeURI(t[1]):null}var d=(e=>(e["SetDomain"]="setDomain",e["SetListToken"]="setListToken",e["SetUserId"]="setUserId",e["SetEvent"]="setEvent",e["SetCookie"]="setCookie",e["SetAutoFunnelData"]="setAutoFunnelData",e["Push"]="push",e["SetCustomServiceWorkerPath"]="setCustomSwPath",e["ViewItem"]="viewItem",e["ViewCategory"]="viewCategory",e["LikeItem"]="likeItem",e["WishListItem"]="wishlistItem",e["ShopifyAbandonedCart"]="shopifyAbandonedCart",e["ImportScript"]="importScript",e))(d||{});const g="_grDebugMode",l=new class{isDebugEnabled(){return!!window.sessionStorage.getItem(g)}startDebug(){window.sessionStorage.setItem(g,"true")}},h=new class{get isLoggingEnabled(){return l.isDebugEnabled()}log(...e){this.displayLog("log",...e)}info(...e){this.displayLog("info",...e)}error(...e){this.displayLog("error",...e)}warn(...e){this.displayLog("warn",...e)}displayLog(e,...t){if(this.isLoggingEnabled)console[e](...t)}};class p{constructor(){this._cvar=[]}setTrackerUrl(e){this.trackerUrl=e}markAsEnabled(e){this.isEnabled=e}setUserId(e){this.uid=e}setCustomVariable(e,t,i){if(!this._cvar[e])this._cvar[e]=[];this._cvar[e].push(t),this._cvar[e].push(i)}setGenerationTime(){var e;if(this.gt_ms)return;const t=null==(e=performance.getEntriesByType("navigation")[0])?void 0:e.toJSON();if(t)this.gt_ms=Math.floor(t.responseEnd-t.requestStart)}trackEvent(e,t,i,s){this.trackPageView(Object.assign({e_c:e,e_a:t,e_n:i,...s&&{e_v:s}}))}getCustomVariable(){return JSON.stringify(Object.assign({},this._cvar))}static getScreenResolution(){return`${screen.width??10}x${screen.height??10}`}static encodeUrlParam(e){return`${encodeURIComponent(e[0])}=${encodeURIComponent(e[1])}`}getFullTrackerUrl(e){const t=new Date;return Object.entries({...e,...document.referrer&&{urlRef:document.referrer},url:window.location.href,uid:this.uid,_cvar:this.getCustomVariable(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),res:p.getScreenResolution(),gt_ms:this.gt_ms}).reduce(((e,t)=>void 0===t[1]?e:`${e}&${p.encodeUrlParam(t)}`),this.trackerUrl)}trackPageView(e){if(e||this.isEnabled)if(this.setGenerationTime(),window.fetch)fetch(this.getFullTrackerUrl(e),{method:"GET",mode:"no-cors"}).catch((e=>{h.error("Error while sending tracking data:",e)}));else new Image(1,1).src=this.getFullTrackerUrl(e)}}var w=(e=>(e["UuidHasBeenSet"]="grUuidHasBeenSet",e["PopupsRendererCustomUrl"]="grPopupsRendererCustomUrl",e))(w||{});class m extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}}class v extends m{constructor(){super("Failed to parse data from JSON string")}}var f=(e=>(e["visitorUuid"]="gaVisitorUuid",e["visitorValuable"]="gaIsValuable",e["VisitorResubscribed"]="gaVisitorResubscribed",e))(f||{}),S=(e=>(e["Show"]="show",e["Close"]="close",e["Submit"]="submit",e))(S||{});const _=new class{constructor(){this.timer=Date.now()}getCurrentVisitOnPageTime(){return Date.now()-this.timer}};class b{constructor(e){this.eventType=e,this.aid=window.__grIntegrationConfig.cData.aid,this.grid=window.__grIntegrationConfig.cData.grid,this.time=_.getCurrentVisitOnPageTime(),this.uuid=a(f.visitorUuid),this.url=window.location.href,this.occurredOn=new Date}get externalUid(){const{xsid:e,email:t,eComId:i}=window.__grIntegrationConfig.visitor;return i||e||t}toJSON(){return{aid:this.aid,grid:this.aid,uuid:this.uuid,externalUid:this.externalUid,time:this.time,url:this.url,eventType:this.eventType,occurredOn:this.occurredOn.toUTCString()}}toString(){return JSON.stringify(this.toJSON())}}var y,I;(I=y||(y={}))["PageVisit"]="visit",I["Popup"]="popup",I["ViewItem"]="view_item",I["ViewCategory"]="view_category",I["WishlistItem"]="wishlist_item",I["LikeItem"]="like_item",void(I["ShopifyAbandonedCart"]="shopify_webhook_abandoned_cart");class k extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}}class C extends k{constructor(e){super(e)}}const U={cartToken:"string",urlToken:"string",visitorEmail:"string"},D=["cartToken","urlToken"];var E,x,P,T,A;(A=E||(E={}))["Inline"]="inline",void(A["Popup"]="popup"),(T=x||(x={}))["Hq"]="Hq",void(T["Us"]="Us"),void((P||(P={}))["UserAid"]="X-Aid");class O extends b{constructor(e,t){super(y.Popup),this.popupEvent=e,this.popupId=t}toJSON(){return{...super.toJSON(),popupId:this.popupId,popupEvent:this.popupEvent}}}class V extends b{toJSON(){return{...super.toJSON(),data:this.data}}}class L extends V{constructor(e){super(y.ViewItem),this.data=e}}class N extends b{constructor(e){super(y.ViewCategory),this.data=e}toJSON(){return{...super.toJSON(),data:this.data}}}class R extends V{constructor(e){super(y.WishlistItem),this.data=e}}class $ extends V{constructor(e){super(y.LikeItem),this.data=e}}class B extends b{constructor(e){super(y.ShopifyAbandonedCart),this.data=e}toJSON(){return{...super.toJSON(),data:this.data}}}const J=class{static getPageVisitEvent(){return new b(y.PageVisit)}static getPopupSubmitEvent(e){return new O(S.Submit,e)}static getPopupShowEvent(e){return new O(S.Show,e)}static getPopupCloseEvent(e){return new O(S.Close,e)}static getViewItemEvent(e){var s;return new L(__privateMethod(s=J,t,i).call(s,e))}static getWishlistItemEvent(e){var s;return new R(__privateMethod(s=J,t,i).call(s,e))}static getLikeItemEvent(e){var s;return new $(__privateMethod(s=J,t,i).call(s,e))}static getViewCategoryEvent(e){const{name:t,id:i,shop:s}=e;return new N({id:i,...t&&{name:t},...s&&{shop:s}})}static getShopifyIntegrationAbandonedCartEvent(e){try{return(e=>{if("object"!=typeof e||null===e)throw new C("Invalid data parameter type");else{const t=Object.entries(U),i=Object.keys(e);if(!D.every((e=>i.includes(e))))throw new C("Lack of required parameters");if(!t.every((([t,i])=>!e[t]||typeof e[t]===i)))throw new C("Properties have invalid type")}return true})(e),new B((t=e,i=Object.keys(U),Object.entries(t).reduce(((e,[t,s])=>{if(i.includes(t))e[t]=s;return e}),{})))}catch(s){return h.error(s),null}var t,i}};let G=J;t=new WeakSet,i=e=>{const{product:t,categories:i,shop:s}=e,r=["id"],n=["id","sku","name","vendor","price","currency"],o=["id","name"],a={product:{}};if(!(null==t?void 0:t.id))return h.error(`Missing required param (product_id: ${(null==t?void 0:t.id)??"undefined"}`),null;if(Object.keys(s??{}).forEach((e=>{if(r.includes(e)){if(!a.shop)a.shop={};a.shop[e]=s[e]}})),Object.keys(t).forEach((e=>{if(n.includes(e))a.product[e]=t[e]})),Array.isArray(i))a.categories=i.map((e=>{const t={};if(Object.keys(e).forEach((i=>{if(o.includes(i))t[i]=e[i]})),t.id)return t;else return null})).filter(Boolean);return a},__privateAdd(G,t);class j{constructor(){__privateAdd(this,s,new Proxy({},{get(e,t){if(t in e)return e[t];else return e[t]=[],e[t]}}))}addEvent(e,t){__privateGet(this,s)[e].push(t)}drainEvents(e){const t=__privateGet(this,s)[e];return __privateGet(this,s)[e]=[],t}hasDelayedEvents(e){return __privateGet(this,s)[e].length>0}}s=new WeakMap,r=new WeakMap,n=new WeakMap;const M=new class{constructor(){__privateAdd(this,r,{}),__privateAdd(this,n,new j)}publish(e,...t){var i;let s=false;if(null==(i=__privateGet(this,r)[e])?void 0:i.length)__privateGet(this,r)[e].forEach((i=>{if(s)h.error(`More than one subscriber is listening on event ${e}`);else i(...t),s=true,h.log(`Event ${e} published with arguments'`,...t)}));else __privateGet(this,n).addEvent(e,t)}subscribe(e,t){if(!__privateGet(this,r)[e])__privateGet(this,r)[e]=[];if(__privateGet(this,n).hasDelayedEvents(e))__privateGet(this,n).drainEvents(e).forEach((e=>t(...e)));__privateGet(this,r)[e].push(t)}unsubscribe(e,t){var i;const s=null==(i=__privateGet(this,r)[e])?void 0:i.indexOf(t);if(s>-1)__privateGet(this,r)[e].splice(s,1)}removeListeners(e){delete __privateGet(this,r)[e]}},F=new class{initialize(e){const{xsid:t,grid:i,domain:s,aid:r,useNOStorage:n,useBetterSubscriberIdentification:o,isServedFromCustomDomain:a,scriptsDomain:c,scriptsVersion:u,tracking:d}=e;window.__grIntegrationConfig=window.__grIntegrationConfig||{cData:{aid:r,grid:i,domain:s,useNOStorage:n,useBetterSubscriberIdentification:o,isServedFromCustomDomain:a},visitor:{email:null,eComId:null,xsid:t},tracking:{isEnabled:d},webEvents:{isModuleInitialized:false},webPush:{customSwPath:null,wpid:null,pushDomain:null,promptEndpoint:null},analyticsData:{scriptsDomain:c,scriptsVersion:u},eventBus:M}}isWebEventModuleInitialized(){return window.__grIntegrationConfig.webEvents.isModuleInitialized??false}setWebEventModuleInitialized(){if(false===window.__grIntegrationConfig.webEvents.isModuleInitialized)window.__grIntegrationConfig.webEvents.isModuleInitialized=true}canUseBackendForSubscriberIdentification(){return window.__grIntegrationConfig.cData.useBetterSubscriberIdentification}getUserAid(){return window.__grIntegrationConfig.cData.aid}getUserAnalyticsDomain(){return window.__grIntegrationConfig.cData.domain}enablePopupDevMode(){window.__grIntegrationConfig.setCustomPopupRendererUrl=e=>{window.sessionStorage.setItem(w.PopupsRendererCustomUrl,e)}}getPopupRendererCustomUrl(){return window.sessionStorage.getItem(w.PopupsRendererCustomUrl)}setCustomSwPath(e){if("string"!=typeof e)throw new Error("Path type must be string");if(!e.match(/gr_sw_main.js$/))throw new Error("Invalid sw file name");window.__grIntegrationConfig.webPush.customSwPath=e}getCustomSwPath(){var e;return null==(e=window.__grIntegrationConfig)?void 0:e.webPush.customSwPath}isTrackingEnabled(){return window.__grIntegrationConfig.tracking.isEnabled}isTrackingScriptServedFromCustomDomain(){return window.__grIntegrationConfig.cData.isServedFromCustomDomain}set visitorEmail(e){window.__grIntegrationConfig.visitor.email=e}get visitorEmail(){return window.__grIntegrationConfig.visitor.email}get pushWpid(){return window.__grIntegrationConfig.webPush.wpid}set pushWpid(e){window.__grIntegrationConfig.webPush.wpid=e}set pushDomain(e){window.__grIntegrationConfig.webPush.pushDomain=e}get pushDomain(){return window.__grIntegrationConfig.webPush.pushDomain}set pushPromptEndpoint(e){window.__grIntegrationConfig.webPush.promptEndpoint=e}get pushPromptEndpoint(){return window.__grIntegrationConfig.webPush.promptEndpoint}get eventBus(){return window.__grIntegrationConfig.eventBus}get canUseBackendStorageForEvents(){return window.__grIntegrationConfig.cData.useNOStorage}get webConnectScriptCdnUrl(){return window.__grIntegrationConfig.analyticsData.scriptsDomain}get webConnectCurrentScriptsVersion(){return window.__grIntegrationConfig.analyticsData.scriptsVersion}};function W(e,t){const i=e.isTextResponse??(null==t?void 0:t.isTextResponse);return fetch(e,{...t,headers:{...null==t?void 0:t.headers,[P.UserAid]:F.getUserAid()}}).then((async e=>{if(e.ok)return i?e.text():e.json();const t=await e.text();return Promise.reject({statusCode:e.status,message:t})}))}class z{static sendJSON(e,t){navigator.sendBeacon(e,new Blob([JSON.stringify({...JSON.parse(t),[P.UserAid]:F.getUserAid()})],{type:"application/json"}))}}const q=new class{constructor(){this.popupsCachedData={}}sendPageVisitEvent(e){z.sendJSON(new URL("activity/event",F.getUserAnalyticsDomain()).href,e.toString())}getUserLastActivityDate(){const e=F.getUserAid();return W(new URL(`activity/session/${e}/${a(f.visitorUuid)}`,F.getUserAnalyticsDomain()).href)}async addPopupEventToStorage(e){z.sendJSON(new URL("activity/event",F.getUserAnalyticsDomain()).href,JSON.stringify(e.toJSON()))}async getPopupActivityData(e){if(this.popupsCachedData)return this.popupsCachedData;const t=F.getUserAid();return this.popupsCachedData=await W(new URL(`activity/popups/${t}/${a(f.visitorUuid)}/${e}`,F.getUserAnalyticsDomain()).href),this.popupsCachedData}async saveECommerceEventToStorage(e){z.sendJSON(new URL("activity/event",F.getUserAnalyticsDomain()).href,JSON.stringify(e.toJSON()))}},H=new class{async isNewVisitor(){return!(await this.getLastActivityDate())}getLastActivityDate(){const{useNOStorage:e}=window.__grIntegrationConfig.cData;return e?this.getLastActivityDateFromBackendStorage():this.getLastActivityDateFromBrowserStorage()}async getLastActivityDateFromBackendStorage(){const e=await q.getUserLastActivityDate();if(null==e?void 0:e.lastActivity)return new Date(e.lastActivity)}getLastActivityDateFromBrowserStorage(){var e;const t=a(f.visitorUuid),i=localStorage.getItem("gaLocalStorageVisitKey");let s;try{s=JSON.parse(i)}catch{throw new v}if(null==s?void 0:s[t])return Promise.resolve(new Date(null==(e=s[t])?void 0:e.lastActivity));else return null}saveUserActivity(){return window.__grIntegrationConfig.cData.useNOStorage?this.saveUserActivityToBackendStorage():this.saveUserActivityToBrowserStorage()}saveUserActivityToBackendStorage(){q.sendPageVisitEvent(G.getPageVisitEvent())}saveUserActivityToBrowserStorage(){const e={[a(f.visitorUuid)]:{lastActivity:G.getPageVisitEvent().occurredOn.toUTCString()}};try{window.localStorage.setItem("gaLocalStorageVisitKey",JSON.stringify(e))}catch{throw new v}}},X=new class{retrieveXsid(){return W(new URL("retrieveXsid",F.getUserAnalyticsDomain()).href,{isTextResponse:true,credentials:"include"})}};var K=(e=>(e["v2"]="v2",e["af"]="af",e["wp"]="wp",e["we"]="we",e["ec"]="ec",e))(K||{}),Y=(e=>(e["v2"]="GRV2",e["af"]="GRAF",e["wp"]="GRWP",e["we"]="GRWE",e["ec"]="GREC",e))(Y||{});class Q extends class{setDomain(e){if(!e||"auto"===e)this.cookieDomain=(()=>{const e=new Date,t=location.hostname.split(".").reverse(),i=[],s=o(6),r=o(6);let n="";for(e.setTime(e.getTime()+60*1e3),i.push(t.shift());t.length>0;){if(n=i.reverse().join("."),document.cookie=`${s}=${r}; expires=${e.toUTCString()}; domain=.${n}; path=/`,a(s)===r)return n;i.push(t.shift())}return location.hostname})();else this.cookieDomain=e}setListToken(e){this.listToken=e}}{constructor(e,t,i,s){super(),this.cookieDomain="",this.listToken="",this.email="",this.uuid=document.cookie.replace(/(?:(?:^|.*;\s*)gaVisitorUuid\s*\=\s*([^;]*).*$)|^.*$/,"$1")||"",this.valuable=Number(document.cookie.replace(/(?:(?:^|.*;\s*)gaIsValuable\s*\=\s*([^;]*).*$)|^.*$/,"$1")||0),this.gr_x=u("gr_x")||"",this.gr_s=u("gr_s")||"",this.gr_m=u("gr_m")||"",this.tracking=new p,this.onImportScript=async(e,...t)=>{if(Object.values(K).includes(e)){const{webConnectScriptCdnUrl:i,webConnectCurrentScriptsVersion:s}=F,r=new URL(`${e}.${s}.umd.js`,i);import(r.href).then((()=>{window[Y[e]].init(...t)}))}else h.error(`Invalid script name ${e}`)},this.onDomainSet=e=>{this.setDomain(e)},this.onListTokenSet=e=>{this.setListToken(e)},this.onSetUserId=(e,t)=>{this.assureDomainIsSet(),this.assureUuidIsSet(),this.setUserId(e,t)},this.onSetEvent=(e,t)=>{this.assureDomainIsSet(),this.assureUuidIsSet(),this.tracking.setUserId(this.serialize()),this.setEvent(e,t)},this.onSetCookie=(e,t)=>{c(e,t,this.cookieDomain)},this.onPush=()=>{this.push()},this.onSetCustomServiceWorkerPath=e=>{F.setCustomSwPath(e)},this.sendPageVisitToAnalyticsStorage=()=>{if("hidden"===document.visibilityState)H.saveUserActivity(),document.removeEventListener("visibilitychange",this.sendPageVisitToAnalyticsStorage)},this.xsid=i||"",this.tracking.setCustomVariable(1,"grid",t),this.tracking.setCustomVariable(2,"aid",s),this.tracking.setTrackerUrl(`${e}index.php?ver=3`),this.tracking.markAsEnabled(F.isTrackingEnabled()),this.tracking.setUserId(this.serialize())}async initialize(){if(!this.xsid&&!this.valuable&&F.isTrackingScriptServedFromCustomDomain())this.xsid=await X.retrieveXsid();this.attachListeners()}attachListeners(){const{eventBus:e}=F;e.subscribe(d.SetDomain,this.onDomainSet),e.subscribe(d.SetListToken,this.onListTokenSet),e.subscribe(d.SetUserId,this.onSetUserId),e.subscribe(d.SetEvent,this.onSetEvent),e.subscribe(d.SetCookie,this.onSetCookie),e.subscribe(d.Push,this.onPush),e.subscribe(d.SetCustomServiceWorkerPath,this.onSetCustomServiceWorkerPath),e.subscribe(d.ImportScript,this.onImportScript)}assureDomainIsSet(){if(!this.cookieDomain)this.onDomainSet("auto")}assureUuidIsSet(){if(!this.uuid){const e=this.generateUuid();window.sessionStorage.setItem(w.UuidHasBeenSet,"true"),this.uuid=e}}setValuability(){if(this.gr_x&&this.gr_s)this.setIsValuable();if(this.email||this.xsid)this.setIsValuable()}assurePageVisitIsStored(){document.addEventListener("visibilitychange",this.sendPageVisitToAnalyticsStorage)}generateUuid(){let e=a("gaVisitorUuid");if(!e)e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),c("gaVisitorUuid",e,this.cookieDomain);return e}setUserId(e,t){if(e&&F.isTrackingEnabled())F.visitorEmail=e,this.email=e,this.listToken=t||this.listToken,this.setIsValuable(),this.push()}setEvent(e,t){if(void 0===t)this.tracking.trackEvent("custom","fire",e);else this.tracking.trackEvent("custom","fire",e,JSON.stringify(t))}push(){this.tracking.setUserId(this.serialize()),this.tracking.trackPageView()}setIsValuable(){if(F.isTrackingEnabled())this.valuable=1,c("gaIsValuable","1",this.cookieDomain)}serialize(){return JSON.stringify({uuid:this.uuid,email:this.email,xsid:this.xsid,list_token:this.listToken,gr_x:this.gr_x,gr_s:this.gr_s,gr_m:this.gr_m,valuable:this.valuable,domain:this.cookieDomain})}}e.init=e=>{const t=JSON.parse(e),{grid:i,aid:s,xsid:r,isServedFromCustomDomain:n,scriptVersion:o,scriptDomain:a,useBackendSubscriberIdentification:c,useBackendStorage:u,trackingUrl:g,tracking:l}=t,h=window["__GetResponseAnalyticsObject"]||"GrTracking";F.initialize({xsid:r,aid:s,grid:i,domain:g,useNOStorage:"true"===u,useBetterSubscriberIdentification:"true"===c,isServedFromCustomDomain:"true"===n,scriptsDomain:a,scriptsVersion:o,tracking:"true"===l});const p=new Q(g,i,r,s);function w(e,t){window[h](e,t)}p.initialize().then((()=>{var e;if(Array.isArray(null==(e=window[h])?void 0:e.q))window[h].q.forEach(((e,t)=>{if("push"!==e[0])F.eventBus.publish(e[0],e[1],e[2]),delete window[h].q[t]}));window[h]=(e,t,i)=>{F.eventBus.publish(e,t,i)},p.assureDomainIsSet(),p.assureUuidIsSet(),p.setValuability(),F.eventBus.publish(d.Push),p.assurePageVisitIsStored()})),window.gaSetUserId=e=>{w(d.SetUserId,e)},window.gaPush=()=>{w(d.Push)}},Object.defineProperties(e,{__esModule:{value:true},[Symbol.toStringTag]:{value:"Module"}})}((e="undefined"!=typeof globalThis?globalThis:e||self).GRV2={})}(this);
